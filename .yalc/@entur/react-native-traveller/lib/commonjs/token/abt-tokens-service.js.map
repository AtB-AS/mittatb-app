{"version":3,"sources":["abt-tokens-service.ts"],"names":["SIGNED_TOKEN_HEADER_KEY","createAbtTokensService","fetcher","hosts","listTokens","url","pto","response","method","body","getTokenCertificate","signedToken","headers","initToken","renewToken","activateToken","tokenId"],"mappings":";;;;;;AAWA,MAAMA,uBAAuB,GAAG,gBAAhC;;AAgBO,MAAMC,sBAAsB,GAAG,CACpCC,OADoC,EAEpCC,KAFoC,KAGf;AACrB,QAAMC,UAAU,GAAG,YAAY;AAC7B,UAAMC,GAAG,GAAI,GAAEF,KAAK,CAACG,GAAI,SAAzB;AACA,UAAMC,QAAQ,GAAG,MAAML,OAAO,CAAqB;AACjDG,MAAAA,GADiD;AAEjDG,MAAAA,MAAM,EAAE;AAFyC,KAArB,CAA9B;AAIA,WAAOD,QAAQ,CAACE,IAAhB;AACD,GAPD;;AASA,QAAMC,mBAAmB,GAAG,MAAOC,WAAP,IAA+B;AACzD,UAAMN,GAAG,GAAI,GAAEF,KAAK,CAACG,GAAI,qBAAzB;AACA,UAAMC,QAAQ,GAAG,MAAML,OAAO,CAA8B;AAC1DG,MAAAA,GAD0D;AAE1DO,MAAAA,OAAO,EAAE;AACP,SAACZ,uBAAD,GAA2BW;AADpB,OAFiD;AAK1DH,MAAAA,MAAM,EAAE;AALkD,KAA9B,CAA9B;AAOA,WAAOD,QAAQ,CAACE,IAAhB;AACD,GAVD;;AAYA,QAAMI,SAAS,GAAG,MAAOJ,IAAP,IAAwC;AACxD,UAAMJ,GAAG,GAAI,GAAEF,KAAK,CAACG,GAAI,SAAzB;AACA,UAAMC,QAAQ,GAAG,MAAML,OAAO,CAA0B;AACtDG,MAAAA,GADsD;AAEtDI,MAAAA,IAFsD;AAGtDD,MAAAA,MAAM,EAAE;AAH8C,KAA1B,CAA9B;AAKA,WAAOD,QAAQ,CAACE,IAAhB;AACD,GARD;;AAUA,QAAMK,UAAU,GAAG,MAAOH,WAAP,IAA+B;AAChD,UAAMN,GAAG,GAAI,GAAEF,KAAK,CAACG,GAAI,eAAzB;AACA,UAAMC,QAAQ,GAAG,MAAML,OAAO,CAAqB;AACjDG,MAAAA,GADiD;AAEjDO,MAAAA,OAAO,EAAE;AACP,SAACZ,uBAAD,GAA2BW;AADpB,OAFwC;AAKjDH,MAAAA,MAAM,EAAE;AALyC,KAArB,CAA9B;AAOA,WAAOD,QAAQ,CAACE,IAAhB;AACD,GAVD;;AAYA,QAAMM,aAAa,GAAG,OACpBC,OADoB,EAEpBP,IAFoB,EAGpBE,WAHoB,KAIjB;AACH,UAAMN,GAAG,GAAI,GAAEF,KAAK,CAACG,GAAI,WAAUU,OAAQ,WAA3C;AACA,UAAMT,QAAQ,GAAG,MAAML,OAAO,CAAwB;AACpDG,MAAAA,GADoD;AAEpDO,MAAAA,OAAO,EAAED,WAAW,GAChB;AACE,SAACX,uBAAD,GAA2BW;AAD7B,OADgB,GAIhB,EANgD;AAOpDF,MAAAA,IAPoD;AAQpDD,MAAAA,MAAM,EAAE;AAR4C,KAAxB,CAA9B;AAWA,WAAOD,QAAQ,CAACE,IAAhB;AACD,GAlBD;;AAoBA,SAAO;AACLL,IAAAA,UADK;AAELM,IAAAA,mBAFK;AAGLG,IAAAA,SAHK;AAILC,IAAAA,UAJK;AAKLC,IAAAA;AALK,GAAP;AAOD,CA1EM","sourcesContent":["import type { Fetch, Hosts } from '../config';\nimport type {\n  ActivateTokenRequest,\n  ActivateTokenResponse,\n  GetTokenCertificateResponse,\n  InitializeTokenRequest,\n  InitializeTokenResponse,\n  ListTokensResponse,\n  RenewTokenResponse,\n} from './types';\n\nconst SIGNED_TOKEN_HEADER_KEY = 'X-Signed-Token';\n\nexport type AbtTokensService = {\n  listTokens: () => Promise<ListTokensResponse>;\n  getTokenCertificate: (\n    signedToken: string\n  ) => Promise<GetTokenCertificateResponse>;\n  initToken: (req: InitializeTokenRequest) => Promise<InitializeTokenResponse>;\n  renewToken: (signedToken: string) => Promise<RenewTokenResponse>;\n  activateToken: (\n    tokenId: string,\n    req: ActivateTokenRequest,\n    signedToken?: string\n  ) => Promise<ActivateTokenResponse>;\n};\n\nexport const createAbtTokensService = (\n  fetcher: Fetch,\n  hosts: Hosts\n): AbtTokensService => {\n  const listTokens = async () => {\n    const url = `${hosts.pto}/tokens`;\n    const response = await fetcher<ListTokensResponse>({\n      url,\n      method: 'GET',\n    });\n    return response.body;\n  };\n\n  const getTokenCertificate = async (signedToken: string) => {\n    const url = `${hosts.pto}/tokens/certificate`;\n    const response = await fetcher<GetTokenCertificateResponse>({\n      url,\n      headers: {\n        [SIGNED_TOKEN_HEADER_KEY]: signedToken,\n      },\n      method: 'GET',\n    });\n    return response.body;\n  };\n\n  const initToken = async (body: InitializeTokenRequest) => {\n    const url = `${hosts.pto}/tokens`;\n    const response = await fetcher<InitializeTokenResponse>({\n      url,\n      body,\n      method: 'POST',\n    });\n    return response.body;\n  };\n\n  const renewToken = async (signedToken: string) => {\n    const url = `${hosts.pto}/tokens/renew`;\n    const response = await fetcher<RenewTokenResponse>({\n      url,\n      headers: {\n        [SIGNED_TOKEN_HEADER_KEY]: signedToken,\n      },\n      method: 'POST',\n    });\n    return response.body;\n  };\n\n  const activateToken = async (\n    tokenId: string,\n    body: ActivateTokenRequest,\n    signedToken?: string\n  ) => {\n    const url = `${hosts.pto}/tokens/${tokenId}/activate`;\n    const response = await fetcher<ActivateTokenResponse>({\n      url,\n      headers: signedToken\n        ? {\n            [SIGNED_TOKEN_HEADER_KEY]: signedToken,\n          }\n        : {},\n      body,\n      method: 'POST',\n    });\n\n    return response.body;\n  };\n\n  return {\n    listTokens,\n    getTokenCertificate,\n    initToken,\n    renewToken,\n    activateToken,\n  };\n};\n"]}