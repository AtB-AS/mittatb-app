{"version":3,"sources":["ActivateNewHandler.ts"],"names":["activateNewHandler","abtTokensService","s","tokenId","accountId","state","logger","info","undefined","activateTokenResponse","activateToken","attestationData","activatedData"],"mappings":";;;;;;;AACA;;AACA;;AACA;;AAEe,SAASA,kBAAT,CACbC,gBADa,EAEC;AACd,SAAO,yCAAoB,CAAC,aAAD,CAApB,EAAqC,MAAOC,CAAP,IAAa;AACvD,UAAM;AAAEC,MAAAA,OAAF;AAAWC,MAAAA,SAAX;AAAsBC,MAAAA;AAAtB,QAAgCH,CAAtC;;AACAI,mBAAOC,IAAP,CAAY,2BAAZ,EAAyCC,SAAzC,EAAoD;AAAEL,MAAAA,OAAF;AAAWC,MAAAA,SAAX;AAAsBC,MAAAA;AAAtB,KAApD;;AAEA,UAAMI,qBAAqB,GAAG,MAAMR,gBAAgB,CAACS,aAAjB,CAClCP,OADkC,EAElCD,CAAC,CAACS,eAFgC,CAApC;AAKA,qCAAqBR,OAArB,EAA8BM,qBAAqB,CAACN,OAApD;AAEA,WAAO;AACLC,MAAAA,SAAS,EAAEA,SADN;AAELC,MAAAA,KAAK,EAAE,UAFF;AAGLF,MAAAA,OAAO,EAAED,CAAC,CAACC,OAHN;AAILS,MAAAA,aAAa,EAAEH;AAJV,KAAP;AAMD,GAjBM,CAAP;AAkBD","sourcesContent":["import type { AbtTokensService } from '../../abt-tokens-service';\nimport { verifyCorrectTokenId } from '../utils';\nimport { StateHandler, stateHandlerFactory } from '../HandlerFactory';\nimport { logger } from '../../../logger';\n\nexport default function activateNewHandler(\n  abtTokensService: AbtTokensService\n): StateHandler {\n  return stateHandlerFactory(['ActivateNew'], async (s) => {\n    const { tokenId, accountId, state } = s;\n    logger.info('mobiletoken_status_change', undefined, { tokenId, accountId, state });\n\n    const activateTokenResponse = await abtTokensService.activateToken(\n      tokenId,\n      s.attestationData\n    );\n\n    verifyCorrectTokenId(tokenId, activateTokenResponse.tokenId);\n\n    return {\n      accountId: accountId,\n      state: 'AddToken',\n      tokenId: s.tokenId,\n      activatedData: activateTokenResponse,\n    };\n  });\n}\n"]}