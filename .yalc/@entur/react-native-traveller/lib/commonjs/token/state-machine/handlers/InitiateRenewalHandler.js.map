{"version":3,"sources":["InitiateRenewalHandler.ts"],"names":["initiateRenewalHandler","abtTokensService","s","accountId","tokenId","logger","info","undefined","signedToken","PayloadAction","addRemoveToken","renewTokenResponse","renewToken","oldTokenId","state","initiatedData"],"mappings":";;;;;;;AAAA;;AAEA;;AAEA;;AACA;;AAEe,SAASA,sBAAT,CACbC,gBADa,EAEC;AACd,SAAO,yCAAoB,CAAC,iBAAD,CAApB,EAAyC,MAAOC,CAAP,IAAa;AAC3D,UAAM;AAAEC,MAAAA,SAAF;AAAaC,MAAAA;AAAb,QAAyBF,CAA/B;;AACAG,mBAAOC,IAAP,CAAY,cAAZ,EAA4BC,SAA5B,EAAuC;AAAEJ,MAAAA,SAAF;AAAaC,MAAAA;AAAb,KAAvC;;AAEA,UAAMI,WAAW,GAAG,MAAM,4BAAeL,SAAf,EAA0BC,OAA1B,EAAmC,IAAnC,EAAyC,CACjEK,qBAAcC,cADmD,CAAzC,CAA1B;AAGA,UAAMC,kBAAkB,GAAG,MAAMV,gBAAgB,CAACW,UAAjB,CAA4BJ,WAA5B,CAAjC;AACA,WAAO;AACLL,MAAAA,SADK;AAELU,MAAAA,UAAU,EAAET,OAFP;AAGLU,MAAAA,KAAK,EAAE,eAHF;AAILC,MAAAA,aAAa,EAAEJ;AAJV,KAAP;AAMD,GAdM,CAAP;AAeD","sourcesContent":["import { getSecureToken } from '../../../native';\nimport type { AbtTokensService } from '../../abt-tokens-service';\nimport { PayloadAction } from '../../../native/types';\nimport type { StateHandler } from '../HandlerFactory';\nimport { stateHandlerFactory } from '../HandlerFactory';\nimport { logger } from '../../../logger';\n\nexport default function initiateRenewalHandler(\n  abtTokensService: AbtTokensService\n): StateHandler {\n  return stateHandlerFactory(['InitiateRenewal'], async (s) => {\n    const { accountId, tokenId } = s;\n    logger.info('init_renewal', undefined, { accountId, tokenId });\n\n    const signedToken = await getSecureToken(accountId, tokenId, true, [\n      PayloadAction.addRemoveToken,\n    ]);\n    const renewTokenResponse = await abtTokensService.renewToken(signedToken);\n    return {\n      accountId,\n      oldTokenId: tokenId,\n      state: 'AttestRenewal',\n      initiatedData: renewTokenResponse,\n    };\n  });\n}\n"]}