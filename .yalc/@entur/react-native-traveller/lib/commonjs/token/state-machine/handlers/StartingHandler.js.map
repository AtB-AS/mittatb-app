{"version":3,"sources":["StartingHandler.ts"],"names":["startingHandler","getClientState","safetyNetApiKey","forceRestart","_","accountId","storeKey","state","savedStateString","AsyncStorage","getItem","savedState","JSON","parse"],"mappings":";;;;;;;AACA;;AAEA;;AACA;;AACA;;;;AAEe,SAASA,eAAT,CACbC,cADa,EAEbC,eAFa,EAGbC,YAHa,EAIC;AACd,SAAO,yCAAoB,CAAC,UAAD,CAApB,EAAkC,MAAOC,CAAP,IAAa;AACpD,UAAM;AAAEC,MAAAA;AAAF,QAAgBJ,cAAc,EAApC;AACA,UAAMK,QAAQ,GAAG,wBAAYD,SAAZ,CAAjB;AACA,UAAM,mBAAYH,eAAZ,CAAN;;AAEA,QAAIC,YAAJ,EAAkB;AAChB,aAAO;AAAEI,QAAAA,KAAK,EAAE;AAAT,OAAP;AACD;;AAED,UAAMC,gBAAgB,GAAG,MAAMC,sBAAaC,OAAb,CAAqBJ,QAArB,CAA/B;;AAEA,QAAI,CAACE,gBAAL,EAAuB;AACrB,aAAO;AAAED,QAAAA,KAAK,EAAE;AAAT,OAAP;AACD;;AAED,UAAMI,UAAU,GAAGC,IAAI,CAACC,KAAL,CAAWL,gBAAX,CAAnB;;AAEA,QAAIG,UAAU,CAACJ,KAAX,KAAqB,OAAzB,EAAkC;AAChC,aAAO;AAAEA,QAAAA,KAAK,EAAE;AAAT,OAAP;AACD;;AAED,WAAOI,UAAP;AACD,GAtBM,CAAP;AAuBD","sourcesContent":["import type { StateHandler } from '../HandlerFactory';\nimport { stateHandlerFactory } from '../HandlerFactory';\nimport type { ClientState } from '../../..';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { getStoreKey } from '../utils';\nimport { start as startNative } from '../../../native';\n\nexport default function startingHandler(\n  getClientState: () => Required<ClientState>,\n  safetyNetApiKey: string,\n  forceRestart: boolean\n): StateHandler {\n  return stateHandlerFactory(['Starting'], async (_) => {\n    const { accountId } = getClientState();\n    const storeKey = getStoreKey(accountId);\n    await startNative(safetyNetApiKey);\n\n    if (forceRestart) {\n      return { state: 'Loading' };\n    }\n\n    const savedStateString = await AsyncStorage.getItem(storeKey);\n\n    if (!savedStateString) {\n      return { state: 'Loading' };\n    }\n\n    const savedState = JSON.parse(savedStateString);\n\n    if (savedState.state === 'Valid') {\n      return { state: 'Loading' };\n    }\n\n    return savedState;\n  });\n}\n"]}