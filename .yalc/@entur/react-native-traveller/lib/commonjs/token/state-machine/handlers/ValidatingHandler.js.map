{"version":3,"sources":["ValidatingHandler.ts"],"names":["validatingHandler","abtTokensService","s","tokens","listTokens","token","find","t","id","tokenId","accountId","state","isInspectable","allowedActions","some","a"],"mappings":";;;;;;;AAGA;;AAEe,SAASA,iBAAT,CACbC,gBADa,EAEC;AACd,SAAO,yCAAoB,CAAC,YAAD,CAApB,EAAoC,MAAOC,CAAP,IAAa;AACtD,UAAMC,MAA0B,GAAG,MAAMF,gBAAgB,CAACG,UAAjB,EAAzC;AACA,UAAMC,KAAK,GAAGF,MAAM,CAACG,IAAP,CAAaC,CAAD,IAAOA,CAAC,CAACC,EAAF,KAASN,CAAC,CAACG,KAAF,CAAQI,OAApC,CAAd;;AACA,QAAI,CAACJ,KAAL,EAAY;AACV,aAAO;AACLK,QAAAA,SAAS,EAAER,CAAC,CAACQ,SADR;AAELC,QAAAA,KAAK,EAAE;AAFF,OAAP;AAID;;AAED,UAAMC,aAAa,GAAGP,KAAK,CAACQ,cAAN,CAAqBC,IAArB,CACnBC,CAAD,IAAOA,CAAC,KAAK,gCADO,CAAtB;AAIA,WAAO;AACLL,MAAAA,SAAS,EAAER,CAAC,CAACQ,SADR;AAELC,MAAAA,KAAK,EAAE,OAFF;AAGLC,MAAAA;AAHK,KAAP;AAKD,GAnBM,CAAP;AAoBD","sourcesContent":["import type { AbtTokensService } from '../../abt-tokens-service';\nimport type { ListTokensResponse } from '../../types';\nimport type { StateHandler } from '../HandlerFactory';\nimport { stateHandlerFactory } from '../HandlerFactory';\n\nexport default function validatingHandler(\n  abtTokensService: AbtTokensService\n): StateHandler {\n  return stateHandlerFactory(['Validating'], async (s) => {\n    const tokens: ListTokensResponse = await abtTokensService.listTokens();\n    const token = tokens.find((t) => t.id === s.token.tokenId);\n    if (!token) {\n      return {\n        accountId: s.accountId,\n        state: 'DeleteLocal',\n      };\n    }\n\n    const isInspectable = token.allowedActions.some(\n      (a) => a === 'TOKEN_ACTION_TICKET_INSPECTION'\n    );\n\n    return {\n      accountId: s.accountId,\n      state: 'Valid',\n      isInspectable,\n    };\n  });\n}\n"]}