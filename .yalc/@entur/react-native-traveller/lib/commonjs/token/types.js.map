{"version":3,"sources":["types.ts"],"names":["errorTypes","tokenStates"],"mappings":";;AAgIA,MAAMA,UAAU,GAAG,CAAC,MAAD,EAAS,QAAT,EAAmB,SAAnB,EAA8B,SAA9B,CAAnB;AAeA,MAAMC,WAAW,GAAG,CAClB,UADkB,EAElB,cAFkB,EAGlB,SAHkB,EAIlB,OAJkB,EAKlB,yBALkB,EAMlB,YANkB,EAOlB,aAPkB,EAQlB,aARkB,EASlB,iBATkB,EAUlB,WAVkB,EAWlB,eAXkB,EAYlB,aAZkB,EAalB,iBAbkB,EAclB,UAdkB,EAelB,wBAfkB,CAApB","sourcesContent":["import type { Token } from '@entur/react-native-traveller';\n\nexport type InitializeTokenRequest = {\n  requireAttestation: boolean;\n  deviceName: string;\n  keyValues?: {\n    [key: string]: string;\n  };\n};\n\nexport type InitializeTokenResponse = {\n  attestationEncryptionPublicKey: string;\n  tokenId: string;\n  /** base64 encoded nonce */\n  nonce: string;\n  nonceValidityEnd: number;\n};\n\nexport type TokenLifecycleState =\n  | 'TOKEN_LIFECYCLE_STATE_UNSPECIFIED'\n  | 'TOKEN_LIFECYCLE_STATE_NOT_ACTIVATED'\n  | 'TOKEN_LIFECYCLE_STATE_ACTIVATED'\n  | 'TOKEN_LIFECYCLE_STATE_CANCELLED'\n  | 'TOKEN_LIFECYCLE_STATE_REMOVED';\n\nexport type TokenType =\n  | 'TOKEN_TYPE_UNSPECIFIED'\n  | 'TOKEN_TYPE_QR_SMARTPHONE'\n  | 'TOKEN_TYPE_QR_PAPER'\n  | 'TOKEN_TYPE_TRAVELCARD'\n  | 'TOKEN_TYPE_REFERENCE_CODE'\n  | 'TOKEN_TYPE_PLAIN_UNSIGNED'\n  | 'TOKEN_TYPE_EXTERNAL';\n\nexport type TokenAction =\n  | 'TOKEN_ACTION_UNSPECIFIED'\n  | 'TOKEN_ACTION_TICKET_TRANSFER'\n  | 'TOKEN_ACTION_ADD_REMOVE_TOKEN'\n  | 'TOKEN_ACTION_IDENTIFICATION'\n  | 'TOKEN_ACTION_TICKET_INSPECTION'\n  | 'TOKEN_ACTION_GET_FARECONTRACTS'\n  | 'TOKEN_ACTION_TRAVELCARD'\n  | 'TOKEN_ACTION_CONSUME_ACCESS_RIGHTS';\n\nexport type StoredToken = {\n  id: string;\n  expires: number;\n  state: TokenLifecycleState;\n  type: TokenType;\n  allowedActions: TokenAction[];\n  deviceName: string;\n  keyValues?: {\n    [key: string]: string;\n  };\n};\n\nexport type ListTokensResponse = StoredToken[];\n\nexport type GetTokenCertificateResponse = ActivateTokenResponse;\n\nexport type RenewTokenResponse = {\n  attestationEncryptionPublicKey: string;\n  tokenId: string;\n  /** base64 encoded nonce */\n  nonce: string;\n  nonceValidityEnd: number;\n};\n\nexport type AttestationIOSDeviceCheck = {\n  attestationType: 'iOS_Device_Check';\n  /** base64 encoded data from iOS DeviceCheck API */\n  encryptedIosDeviceCheckData: string;\n  /** base64 encoded RSA encrypted AES key, for attestation type 'iOS_Device_Check'. Encrypted with the attestationEncryptionPublicKey from InitializeTokenResponse. */\n  attestationEncryptionEncryptedKey: string;\n};\n\nexport type ActivateTokenRequest = {\n  /** base64 encoded token public key */\n  signaturePublicKey?: string;\n  encryptionPublicKey?: string;\n  attestation:\n    | {\n        attestationType: 'iOS_Device_Check';\n        /** base64 encoded data from iOS DeviceCheck API */\n        encryptedIosDeviceCheckData: string;\n        /** base64 encoded RSA encrypted AES key, for attestation type 'iOS_Device_Check'. Encrypted with the attestationEncryptionPublicKey from InitializeTokenResponse. */\n        attestationEncryptionEncryptedKey: string;\n      }\n    | {\n        attestationType: 'SafetyNet';\n        /** SafetyNet JWS from client */\n        safetyNetJws: string;\n        /** base64 encoded attestations for public key, for attestation type 'SafetyNet'. */\n        signaturePublicKeyAttestation: string[];\n        /** base64 encoded attestations for encryption public key, for attestation type 'SafetyNet'. */\n        encryptionPublicKeyAttestation: string[];\n      }\n    | {\n        attestationType: 'iOS_Device_Attestation';\n        /** base64 encoded object from API, should be created with serialized DeviceAttestationData as a challeng */\n        attestationObject: string;\n        /** base64 encoded key id, from generated iOS app attest data. */\n        keyId: string;\n        /** base64 encoded serialized DeviceAttestationData protobuf */\n        deviceAttestationData: string;\n      };\n};\n\nexport type ActivateTokenResponse = {\n  // base64 encoded certificate\n  certificate: string;\n  tokenId: string;\n  tokenValidityStart: number;\n  tokenValidityEnd: number;\n};\n\nexport type ToggleTokenRequest = {\n  overrideExisting: boolean;\n};\n\nexport type ToggleTokenResponse = {\n  tokens: StoredToken[];\n};\n\nexport type ValidateTokenResponse = {\n  state: 'Valid' | 'NotFound' | 'NeedsRenewal';\n};\n\nconst errorTypes = ['None', 'Severe', 'Unknown', 'Network'] as const;\nexport type ErrorType = typeof errorTypes[number];\n\nexport type TokenError = {\n  missingNetConnection: boolean;\n  message: string;\n  err?: any;\n};\n\nexport type TokenStatus = {\n  state: TokenState;\n  error?: TokenError;\n  visualState: VisualState;\n};\n\nconst tokenStates = [\n  'Starting',\n  'NotSupported',\n  'Loading',\n  'Valid',\n  'GettingTokenCertificate',\n  'Validating',\n  'DeleteLocal',\n  'InitiateNew',\n  'InitiateRenewal',\n  'AttestNew',\n  'AttestRenewal',\n  'ActivateNew',\n  'ActivateRenewal',\n  'AddToken',\n  'VerifyInspectionAction',\n] as const;\nexport type TokenState = typeof tokenStates[number];\n\nexport type StoredState = {\n  accountId: string;\n  error?: TokenError;\n} & (\n  | {\n      state:\n        | 'Starting'\n        | 'Loading'\n        | 'InitiateNew'\n        | 'DeleteLocal'\n        | 'NotSupported';\n    }\n  | {\n      state:\n        | 'GettingTokenCertificate'\n        | 'InitiateRenewal'\n        | 'VerifyInspectionAction';\n      tokenId: string;\n    }\n  | { state: 'Valid'; isInspectable: boolean }\n  | {\n      state: 'Validating';\n      token: Token;\n    }\n  | {\n      state: 'AttestNew';\n      initiatedData: InitializeTokenResponse;\n    }\n  | {\n      state: 'AttestRenewal';\n      initiatedData: InitializeTokenResponse;\n      oldTokenId: string;\n    }\n  | {\n      state: 'ActivateNew';\n      attestationData: ActivateTokenRequest;\n      tokenId: string;\n    }\n  | {\n      state: 'ActivateRenewal';\n      attestationData: ActivateTokenRequest;\n      tokenId: string;\n      oldTokenId: string;\n    }\n  | {\n      state: 'AddToken';\n      activatedData: ActivateTokenResponse;\n    }\n);\n\nexport type VisualState =\n  | 'Token'\n  | 'NotInspectable'\n  | 'Loading'\n  | 'Error'\n  | 'MissingNetConnection';\n"]}