{"version":3,"sources":["ActivateNewHandler.ts"],"names":["verifyCorrectTokenId","stateHandlerFactory","logger","activateNewHandler","abtTokensService","s","tokenId","accountId","state","info","undefined","activateTokenResponse","activateToken","attestationData","activatedData"],"mappings":"AACA,SAASA,oBAAT,QAAqC,UAArC;AACA,SAAuBC,mBAAvB,QAAkD,mBAAlD;AACA,SAASC,MAAT,QAAuB,iBAAvB;AAEA,eAAe,SAASC,kBAAT,CACbC,gBADa,EAEC;AACd,SAAOH,mBAAmB,CAAC,CAAC,aAAD,CAAD,EAAkB,MAAOI,CAAP,IAAa;AACvD,UAAM;AAAEC,MAAAA,OAAF;AAAWC,MAAAA,SAAX;AAAsBC,MAAAA;AAAtB,QAAgCH,CAAtC;AACAH,IAAAA,MAAM,CAACO,IAAP,CAAY,2BAAZ,EAAyCC,SAAzC,EAAoD;AAAEJ,MAAAA,OAAF;AAAWC,MAAAA,SAAX;AAAsBC,MAAAA;AAAtB,KAApD;AAEA,UAAMG,qBAAqB,GAAG,MAAMP,gBAAgB,CAACQ,aAAjB,CAClCN,OADkC,EAElCD,CAAC,CAACQ,eAFgC,CAApC;AAKAb,IAAAA,oBAAoB,CAACM,OAAD,EAAUK,qBAAqB,CAACL,OAAhC,CAApB;AAEA,WAAO;AACLC,MAAAA,SAAS,EAAEA,SADN;AAELC,MAAAA,KAAK,EAAE,UAFF;AAGLF,MAAAA,OAAO,EAAED,CAAC,CAACC,OAHN;AAILQ,MAAAA,aAAa,EAAEH;AAJV,KAAP;AAMD,GAjByB,CAA1B;AAkBD","sourcesContent":["import type { AbtTokensService } from '../../abt-tokens-service';\nimport { verifyCorrectTokenId } from '../utils';\nimport { StateHandler, stateHandlerFactory } from '../HandlerFactory';\nimport { logger } from '../../../logger';\n\nexport default function activateNewHandler(\n  abtTokensService: AbtTokensService\n): StateHandler {\n  return stateHandlerFactory(['ActivateNew'], async (s) => {\n    const { tokenId, accountId, state } = s;\n    logger.info('mobiletoken_status_change', undefined, { tokenId, accountId, state });\n\n    const activateTokenResponse = await abtTokensService.activateToken(\n      tokenId,\n      s.attestationData\n    );\n\n    verifyCorrectTokenId(tokenId, activateTokenResponse.tokenId);\n\n    return {\n      accountId: accountId,\n      state: 'AddToken',\n      tokenId: s.tokenId,\n      activatedData: activateTokenResponse,\n    };\n  });\n}\n"]}