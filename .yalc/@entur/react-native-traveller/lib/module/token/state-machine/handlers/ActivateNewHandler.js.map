{"version":3,"sources":["ActivateNewHandler.ts"],"names":["verifyCorrectTokenId","stateHandlerFactory","logger","activateNewHandler","abtTokensService","s","tokenId","accountId","info","undefined","activateTokenResponse","activateToken","attestationData","state","activatedData"],"mappings":"AACA,SAASA,oBAAT,QAAqC,UAArC;AACA,SAAuBC,mBAAvB,QAAkD,mBAAlD;AACA,SAASC,MAAT,QAAuB,iBAAvB;AAEA,eAAe,SAASC,kBAAT,CACbC,gBADa,EAEC;AACd,SAAOH,mBAAmB,CAAC,CAAC,aAAD,CAAD,EAAkB,MAAOI,CAAP,IAAa;AACvD,UAAM;AAAEC,MAAAA,OAAF;AAAWC,MAAAA;AAAX,QAAyBF,CAA/B;AACAH,IAAAA,MAAM,CAACM,IAAP,CAAY,cAAZ,EAA4BC,SAA5B,EAAuC;AAAEH,MAAAA,OAAF;AAAWC,MAAAA;AAAX,KAAvC;AAEA,UAAMG,qBAAqB,GAAG,MAAMN,gBAAgB,CAACO,aAAjB,CAClCL,OADkC,EAElCD,CAAC,CAACO,eAFgC,CAApC;AAKAZ,IAAAA,oBAAoB,CAACM,OAAD,EAAUI,qBAAqB,CAACJ,OAAhC,CAApB;AAEA,WAAO;AACLC,MAAAA,SAAS,EAAEA,SADN;AAELM,MAAAA,KAAK,EAAE,UAFF;AAGLP,MAAAA,OAAO,EAAED,CAAC,CAACC,OAHN;AAILQ,MAAAA,aAAa,EAAEJ;AAJV,KAAP;AAMD,GAjByB,CAA1B;AAkBD","sourcesContent":["import type { AbtTokensService } from '../../abt-tokens-service';\nimport { verifyCorrectTokenId } from '../utils';\nimport { StateHandler, stateHandlerFactory } from '../HandlerFactory';\nimport { logger } from '../../../logger';\n\nexport default function activateNewHandler(\n  abtTokensService: AbtTokensService\n): StateHandler {\n  return stateHandlerFactory(['ActivateNew'], async (s) => {\n    const { tokenId, accountId } = s;\n    logger.info('activate_new', undefined, { tokenId, accountId });\n\n    const activateTokenResponse = await abtTokensService.activateToken(\n      tokenId,\n      s.attestationData\n    );\n\n    verifyCorrectTokenId(tokenId, activateTokenResponse.tokenId);\n\n    return {\n      accountId: accountId,\n      state: 'AddToken',\n      tokenId: s.tokenId,\n      activatedData: activateTokenResponse,\n    };\n  });\n}\n"]}