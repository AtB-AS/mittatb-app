{"version":3,"sources":["GetTokenCertificateHandler.ts"],"names":["getSecureToken","PayloadAction","stateHandlerFactory","logger","getTokenCertificateHandler","abtTokensService","s","accountId","tokenId","state","info","undefined","signedToken","addRemoveToken","tokenCertificateResponse","getTokenCertificate","activatedData"],"mappings":"AAAA,SAASA,cAAT,QAA+B,iBAA/B;AAEA,SAASC,aAAT,QAA8B,uBAA9B;AAEA,SAASC,mBAAT,QAAoC,mBAApC;AACA,SAASC,MAAT,QAAuB,iBAAvB;AAEA,eAAe,SAASC,0BAAT,CACbC,gBADa,EAEC;AACd,SAAOH,mBAAmB,CAAC,CAAC,yBAAD,CAAD,EAA8B,MAAOI,CAAP,IAAa;AACnE,UAAM;AAAEC,MAAAA,SAAF;AAAaC,MAAAA,OAAb;AAAsBC,MAAAA;AAAtB,QAAgCH,CAAtC;AACAH,IAAAA,MAAM,CAACO,IAAP,CAAY,2BAAZ,EAAyCC,SAAzC,EAAoD;AAClDF,MAAAA,KADkD;AAElDF,MAAAA,SAFkD;AAGlDC,MAAAA;AAHkD,KAApD;AAMA,UAAMI,WAAW,GAAG,MAAMZ,cAAc,CAACO,SAAD,EAAYC,OAAZ,EAAqB,KAArB,EAA4B,CAClEP,aAAa,CAACY,cADoD,CAA5B,CAAxC;AAGA,UAAMC,wBAAwB,GAAG,MAAMT,gBAAgB,CAACU,mBAAjB,CACrCH,WADqC,CAAvC;AAGA,WAAO;AACLL,MAAAA,SADK;AAELE,MAAAA,KAAK,EAAE,UAFF;AAGLD,MAAAA,OAAO,EAAEF,CAAC,CAACE,OAHN;AAILQ,MAAAA,aAAa,EAAEF;AAJV,KAAP;AAMD,GApByB,CAA1B;AAqBD","sourcesContent":["import { getSecureToken } from '../../../native';\nimport type { AbtTokensService } from '../../abt-tokens-service';\nimport { PayloadAction } from '../../../native/types';\nimport type { StateHandler } from '../HandlerFactory';\nimport { stateHandlerFactory } from '../HandlerFactory';\nimport { logger } from '../../../logger';\n\nexport default function getTokenCertificateHandler(\n  abtTokensService: AbtTokensService\n): StateHandler {\n  return stateHandlerFactory(['GettingTokenCertificate'], async (s) => {\n    const { accountId, tokenId, state } = s;\n    logger.info('mobiletoken_status_change', undefined, {\n      state,\n      accountId,\n      tokenId,\n    });\n\n    const signedToken = await getSecureToken(accountId, tokenId, false, [\n      PayloadAction.addRemoveToken,\n    ]);\n    const tokenCertificateResponse = await abtTokensService.getTokenCertificate(\n      signedToken\n    );\n    return {\n      accountId,\n      state: 'AddToken',\n      tokenId: s.tokenId,\n      activatedData: tokenCertificateResponse,\n    };\n  });\n}\n"]}