{"version":3,"sources":["InitiateNewHandler.ts"],"names":["Platform","stateHandlerFactory","getDeviceName","logger","requireAttestation","select","default","ios","initiateNewHandler","abtTokensService","s","deviceName","accountId","state","info","undefined","initTokenResponse","initToken","initiatedData"],"mappings":"AACA,SAASA,QAAT,QAAyB,cAAzB;AAEA,SAASC,mBAAT,QAAoC,mBAApC;AACA,SAASC,aAAT,QAA8B,iBAA9B;AACA,SAASC,MAAT,QAAuB,iBAAvB;AAEA,MAAMC,kBAAkB,GAAGJ,QAAQ,CAACK,MAAT,CAAgB;AACzCC,EAAAA,OAAO,EAAE,IADgC;AAEzCC,EAAAA,GAAG,EAAE;AAFoC,CAAhB,CAA3B;AAKA,eAAe,SAASC,kBAAT,CACbC,gBADa,EAEC;AACd,SAAOR,mBAAmB,CAAC,CAAC,aAAD,CAAD,EAAkB,MAAOS,CAAP,IAAa;AACvD,QAAIC,UAAU,GAAG,SAAjB;;AACA,QAAI;AACFA,MAAAA,UAAU,GAAG,MAAMT,aAAa,EAAhC;AACD,KAFD,CAEE,MAAM,CAAE;;AAEV,UAAM;AAAEU,MAAAA,SAAF;AAAaC,MAAAA;AAAb,QAAuBH,CAA7B;AAEAP,IAAAA,MAAM,CAACW,IAAP,CAAY,2BAAZ,EAAyCC,SAAzC,EAAoD;AAClDF,MAAAA,KADkD;AAElDF,MAAAA,UAFkD;AAGlDC,MAAAA;AAHkD,KAApD;AAMA,UAAMI,iBAAiB,GAAG,MAAMP,gBAAgB,CAACQ,SAAjB,CAA2B;AACzDb,MAAAA,kBADyD;AAEzDO,MAAAA;AAFyD,KAA3B,CAAhC;AAKA,WAAO;AACLC,MAAAA,SAAS,EAAEA,SADN;AAELC,MAAAA,KAAK,EAAE,WAFF;AAGLK,MAAAA,aAAa,EAAEF;AAHV,KAAP;AAKD,GAxByB,CAA1B;AAyBD","sourcesContent":["import type { AbtTokensService } from '../../abt-tokens-service';\nimport { Platform } from 'react-native';\nimport type { StateHandler } from '../HandlerFactory';\nimport { stateHandlerFactory } from '../HandlerFactory';\nimport { getDeviceName } from '../../../native';\nimport { logger } from '../../../logger';\n\nconst requireAttestation = Platform.select({\n  default: true,\n  ios: false,\n});\n\nexport default function initiateNewHandler(\n  abtTokensService: AbtTokensService\n): StateHandler {\n  return stateHandlerFactory(['InitiateNew'], async (s) => {\n    let deviceName = 'unknown';\n    try {\n      deviceName = await getDeviceName();\n    } catch {}\n\n    const { accountId, state } = s;\n\n    logger.info('mobiletoken_status_change', undefined, {\n      state,\n      deviceName,\n      accountId,\n    });\n\n    const initTokenResponse = await abtTokensService.initToken({\n      requireAttestation,\n      deviceName,\n    });\n\n    return {\n      accountId: accountId,\n      state: 'AttestNew',\n      initiatedData: initTokenResponse,\n    };\n  });\n}\n"]}