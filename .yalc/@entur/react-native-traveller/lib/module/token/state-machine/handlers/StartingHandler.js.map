{"version":3,"sources":["StartingHandler.ts"],"names":["stateHandlerFactory","AsyncStorage","getStoreKey","start","startNative","startingHandler","safetyNetApiKey","forceRestart","s","storeKey","accountId","state","savedStateString","getItem","savedState","JSON","parse"],"mappings":"AACA,SAASA,mBAAT,QAAoC,mBAApC;AACA,OAAOC,YAAP,MAAyB,2CAAzB;AACA,SAASC,WAAT,QAA4B,UAA5B;AACA,SAASC,KAAK,IAAIC,WAAlB,QAAqC,iBAArC;AAEA,eAAe,SAASC,eAAT,CACbC,eADa,EAEbC,YAFa,EAGC;AACd,SAAOP,mBAAmB,CAAC,CAAC,UAAD,CAAD,EAAe,MAAOQ,CAAP,IAAa;AACpD,UAAMC,QAAQ,GAAGP,WAAW,CAACM,CAAC,CAACE,SAAH,CAA5B;AACA,UAAMN,WAAW,CAACE,eAAD,CAAjB;;AAEA,QAAIC,YAAJ,EAAkB;AAChB,aAAO;AACLG,QAAAA,SAAS,EAAEF,CAAC,CAACE,SADR;AAELC,QAAAA,KAAK,EAAE;AAFF,OAAP;AAID;;AAED,UAAMC,gBAAgB,GAAG,MAAMX,YAAY,CAACY,OAAb,CAAqBJ,QAArB,CAA/B;;AAEA,QAAI,CAACG,gBAAL,EAAuB;AACrB,aAAO;AACLF,QAAAA,SAAS,EAAEF,CAAC,CAACE,SADR;AAELC,QAAAA,KAAK,EAAE;AAFF,OAAP;AAID;;AAED,UAAMG,UAAU,GAAGC,IAAI,CAACC,KAAL,CAAWJ,gBAAX,CAAnB;;AAEA,QAAIE,UAAU,CAACH,KAAX,KAAqB,OAAzB,EAAkC;AAChC,aAAO;AACLD,QAAAA,SAAS,EAAEF,CAAC,CAACE,SADR;AAELC,QAAAA,KAAK,EAAE;AAFF,OAAP;AAID;;AAED,WAAOG,UAAP;AACD,GA9ByB,CAA1B;AA+BD","sourcesContent":["import type { StateHandler } from '../HandlerFactory';\nimport { stateHandlerFactory } from '../HandlerFactory';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { getStoreKey } from '../utils';\nimport { start as startNative } from '../../../native';\n\nexport default function startingHandler(\n  safetyNetApiKey: string,\n  forceRestart: boolean\n): StateHandler {\n  return stateHandlerFactory(['Starting'], async (s) => {\n    const storeKey = getStoreKey(s.accountId);\n    await startNative(safetyNetApiKey);\n\n    if (forceRestart) {\n      return {\n        accountId: s.accountId,\n        state: 'Loading',\n      };\n    }\n\n    const savedStateString = await AsyncStorage.getItem(storeKey);\n\n    if (!savedStateString) {\n      return {\n        accountId: s.accountId,\n        state: 'Loading',\n      };\n    }\n\n    const savedState = JSON.parse(savedStateString);\n\n    if (savedState.state === 'Valid') {\n      return {\n        accountId: s.accountId,\n        state: 'Loading',\n      };\n    }\n\n    return savedState;\n  });\n}\n"]}