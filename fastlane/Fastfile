fastlane_version '2.142.0'

before_all do
  # ensure_git_status_clean
  # git_pull
end

platform :ios do
  # iOS Lanes
  desc 'Build the iOS application.'
  lane :build do
      if is_ci
        create_keychain(
          name: "CI",
          password: ENV["MATCH_PASSWORD"],
          default_keychain: true,
          unlock: true,
          timeout: 3600,
          lock_when_sleeps: false
        )
        match(
          type: "adhoc",
          readonly: true,
          keychain_name: "CI",
          keychain_password: ENV["MATCH_PASSWORD"]
        )
      else
        match(type: 'adhoc', readonly: true)
      end
      update_app_identifier(
        xcodeproj: "./ios/atb.xcodeproj",
        plist_path: "atb/Info.plist", 
        app_identifier: ENV["IOS_BUNDLE_IDENTIFIER"]
      )
      cocoapods(podfile: './ios/Podfile')
      build_app(
        scheme: 'atb', 
        configuration: 'Release', 
        workspace: './ios/atb.xcworkspace', 
        export_xcargs: "-allowProvisioningUpdates",
        export_options: {
          provisioningProfiles: { 
            "no.mittatb.staging" => "match AdHoc no.mittatb.staging",
          }
        })
    end
end

platform :android do
  # Android Lanes
end