fastlane_version '2.142.0'

before_all do
  # ensure_git_status_clean
  # git_pull
end

platform :ios do
  # iOS Lanes
  desc 'Build the iOS application.'
  lane :build do
      match(type: 'adhoc', readonly: true)
      update_app_identifier(
        xcodeproj: "./ios/atb.xcodeproj",
        plist_path: "atb/Info.plist", 
        app_identifier: ENV["IOS_BUNDLE_IDENTIFIER"]
      )
      cocoapods(podfile: './ios/Podfile')
      build_app(
        scheme: 'atb', 
        configuration: 'Release', 
        workspace: './ios/atb.xcworkspace', 
        export_xcargs: "-allowProvisioningUpdates",
        export_options: {
          provisioningProfiles: { 
            "no.mittatb.staging" => "match AdHoc no.mittatb.staging",
          }
        })
    end
end

platform :android do
  # Android Lanes
end